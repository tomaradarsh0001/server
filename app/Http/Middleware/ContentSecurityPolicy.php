<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class ContentSecurityPolicy
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        $response = $next($request);

        // $csp = implode(' ', [
        //     "default-src 'self';",
        //     "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://scanex.github.io https://cdnjs.cloudflare.com https://ptma.github.io https://cdnjs.cloudflare.com https://unpkg.com https://cdn.jsdelivr.net https://ajax.googleapis.com https://cdn.jsdelivr.net/npm/toastify-js http://127.0.0.1:8000 https://ish.lol http://127.0.0.1:8000/assets/MIS_V3/leaflet-labeler.js http://127.0.0.1:8000/assets/MIS_V3/Geojson_s/Vacant_Land_P3.js http://127.0.0.1:8000/assets/MIS_V3/Logo.js https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js https://cdn.jsdelivr.net/npm/flatpickr https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js https://127.0.0.1:8000/assets/frontend/assets/js/popper.min.js https://127.0.0.1:8000/assets/frontend/assets/js/bootstrap.bundle.min.js https://127.0.0.1:8000/assets/frontend/assets/js/custom.js https://cdn.jsdelivr.net/npm/toastify-js https://127.0.0.1:8000/assets/js/widget.js http://127.0.0.1:8000/assets/js/jquery.min.js http://127.0.0.1:8000/assets/js/jquery-3.5.1.js http://127.0.0.1:8000/assets/js/jquery.dataTables.min.js http://127.0.0.1:8000/assets/js/dataTables.buttons.min.js http://127.0.0.1:8000/assets/js/buttons.flash.min.js http://127.0.0.1:8000/assets/js/jszip.min.js http://127.0.0.1:8000/assets/js/buttons.html5.min.js http://127.0.0.1:8000/assets/js/buttons.print.min.js http://127.0.0.1:8000/assets/js/pdfmake.min.js http://127.0.0.1:8000/assets/js/vfs_fonts.js http://127.0.0.1:8000/assets/js/dataTables.responsive.min.js http://127.0.0.1:8000/assets/js/pace.min.js http://127.0.0.1:8000/assets/js/bootstrap.bundle.min.js http://127.0.0.1:8000/assets/js/jquery-ui.min.js http://127.0.0.1:8000/assets/js/app.js http://127.0.0.1:8000/assets/plugins/simplebar/js/simplebar.min.js http://127.0.0.1:8000/assets/plugins/metismenu/js/metisMenu.min.js http://127.0.0.1:8000/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js http://127.0.0.1:8000/assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js http://127.0.0.1:8000/assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js http://127.0.0.1:8000/assets/plugins/datatable/js/dataTables.bootstrap5.min.js http://127.0.0.1:8000/assets/js/summernote-lite.min.js https://cdn.jsdelivr.net/npm/toastify-js;",
        //     "style-src 'self' 'unsafe-inline' https://scanex.github.io/Leaflet-IconLayers/src/iconLayers.css https://cdn.jsdelivr.net https://unpkg.com https://fonts.googleapis.com https://ptma.github.io https://cdn.jsdelivr.net https://fonts.googleapis.com https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.css https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css https://unpkg.com/leaflet@1.9.4/dist/leaflet.css http://127.0.0.1:8000/assets/MIS_V3/leaflet-labeler.css https://127.0.0.1:8000/assets/frontend/assets/css/bootstrap.min.css https://127.0.0.1:8000/assets/frontend/assets/fonts/font-awesome/css/font-awesome.min.css https://cdn.lineicons.com/4.0/lineicons.css https://127.0.0.1:8000/assets/frontend/assets/fonts/flaticon/font/flaticon.css https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons/css/all/all.css http://127.0.0.1:8000/assets/css/googleapi_css1.css http://127.0.0.1:8000/assets/css/googleapi_css2.css https://127.0.0.1:8000/assets/frontend/assets/css/style.css https://127.0.0.1:8000/assets/frontend/assets/css/skins/default.css https://127.0.0.1:8000/assets/frontend/assets/css/custom.css https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css http://127.0.0.1:8000/assets/plugins/vectormap/jquery-jvectormap-2.0.2.css http://127.0.0.1:8000/assets/plugins/simplebar/css/simplebar.css http://127.0.0.1:8000/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css http://127.0.0.1:8000/assets/plugins/metismenu/css/metisMenu.min.css http://127.0.0.1:8000/assets/css/jquery-ui.css http://127.0.0.1:8000/assets/css/pace.min.css http://127.0.0.1:8000/assets/css/bootstrap.min.css http://127.0.0.1:8000/assets/css/bootstrap-extended.css http://127.0.0.1:8000/assets/css/bootstrap-select.min.css http://127.0.0.1:8000/assets/plugins/datatable/css/dataTables.bootstrap5.min.css http://127.0.0.1:8000/assets/css/app.css http://127.0.0.1:8000/assets/css/custom.css http://127.0.0.1:8000/assets/css/icons.css https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css http://127.0.0.1:8000/assets/css/dark-theme.css http://127.0.0.1:8000/assets/css/semi-dark.css http://127.0.0.1:8000/assets/css/header-colors.css http://127.0.0.1:8000/assets/css/range.css http://127.0.0.1:8000/assets/css/jquery.dataTables.min.css http://127.0.0.1:8000/assets/css/buttons.dataTables.min.css http://127.0.0.1:8000/assets/css/responsive.dataTables.min.css https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css;",
        //     "font-src 'self' https://fonts.gstatic.com  https://fonts.googleapis.com http://127.0.0.1:8000 https://cdn.lineicons.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net;",
        //     "img-src 'self' data: http://127.0.0.1:8000;",
        //     "connect-src 'self' http://127.0.0.1:8000;",
        //     "frame-ancestors 'none'",
        //     "worker-src 'self' blob:http://127.0.0.1:8000;"
            
        // ]);

        $csp = implode(' ', [
            "default-src 'self';",
            "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://stackpath.bootstrapcdn.com https://code.jquery.com https://scanex.github.io https://cdnjs.cloudflare.com https://ptma.github.io https://cdnjs.cloudflare.com https://unpkg.com https://cdn.jsdelivr.net https://ajax.googleapis.com https://cdn.jsdelivr.net/npm/toastify-js http://127.0.0.1:8000 https://ish.lol http://127.0.0.1:8000/assets/MIS_V3/leaflet-labeler.js http://127.0.0.1:8000/assets/MIS_V3/Geojson_s/Vacant_Land_P3.js http://127.0.0.1:8000/assets/MIS_V3/Logo.js https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js https://cdn.jsdelivr.net/npm/flatpickr https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js https://127.0.0.1:8000/assets/frontend/assets/js/popper.min.js https://127.0.0.1:8000/assets/frontend/assets/js/bootstrap.bundle.min.js https://127.0.0.1:8000/assets/frontend/assets/js/custom.js https://cdn.jsdelivr.net/npm/toastify-js https://127.0.0.1:8000/assets/js/widget.js http://127.0.0.1:8000/assets/js/jquery.min.js http://127.0.0.1:8000/assets/js/jquery-3.5.1.js http://127.0.0.1:8000/assets/js/jquery.dataTables.min.js http://127.0.0.1:8000/assets/js/dataTables.buttons.min.js http://127.0.0.1:8000/assets/js/buttons.flash.min.js http://127.0.0.1:8000/assets/js/jszip.min.js http://127.0.0.1:8000/assets/js/buttons.html5.min.js http://127.0.0.1:8000/assets/js/buttons.print.min.js http://127.0.0.1:8000/assets/js/pdfmake.min.js http://127.0.0.1:8000/assets/js/vfs_fonts.js http://127.0.0.1:8000/assets/js/dataTables.responsive.min.js http://127.0.0.1:8000/assets/js/pace.min.js http://127.0.0.1:8000/assets/js/bootstrap.bundle.min.js http://127.0.0.1:8000/assets/js/jquery-ui.min.js http://127.0.0.1:8000/assets/js/app.js http://127.0.0.1:8000/assets/plugins/simplebar/js/simplebar.min.js http://127.0.0.1:8000/assets/plugins/metismenu/js/metisMenu.min.js http://127.0.0.1:8000/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js http://127.0.0.1:8000/assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js http://127.0.0.1:8000/assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js http://127.0.0.1:8000/assets/plugins/datatable/js/dataTables.bootstrap5.min.js http://127.0.0.1:8000/assets/js/summernote-lite.min.js https://cdn.jsdelivr.net/npm/toastify-js https://maps.googleapis.com https://cdn.datatables.net;",
            "style-src 'self' 'unsafe-inline' https://code.jquery.com https://cdnjs.cloudflare.com https://scanex.github.io/Leaflet-IconLayers/src/iconLayers.css https://cdn.jsdelivr.net https://unpkg.com https://fonts.googleapis.com https://ptma.github.io https://cdn.jsdelivr.net https://fonts.googleapis.com https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.css https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css https://unpkg.com/leaflet@1.9.4/dist/leaflet.css http://127.0.0.1:8000/assets/MIS_V3/leaflet-labeler.css https://127.0.0.1:8000/assets/frontend/assets/css/bootstrap.min.css https://127.0.0.1:8000/assets/frontend/assets/fonts/font-awesome/css/font-awesome.min.css https://cdn.lineicons.com/4.0/lineicons.css https://127.0.0.1:8000/assets/frontend/assets/fonts/flaticon/font/flaticon.css https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons/css/all/all.css http://127.0.0.1:8000/assets/css/googleapi_css1.css http://127.0.0.1:8000/assets/css/googleapi_css2.css https://127.0.0.1:8000/assets/frontend/assets/css/style.css https://127.0.0.1:8000/assets/frontend/assets/css/skins/default.css https://127.0.0.1:8000/assets/frontend/assets/css/custom.css https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css http://127.0.0.1:8000/assets/plugins/vectormap/jquery-jvectormap-2.0.2.css http://127.0.0.1:8000/assets/plugins/simplebar/css/simplebar.css http://127.0.0.1:8000/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css http://127.0.0.1:8000/assets/plugins/metismenu/css/metisMenu.min.css http://127.0.0.1:8000/assets/css/jquery-ui.css http://127.0.0.1:8000/assets/css/pace.min.css http://127.0.0.1:8000/assets/css/bootstrap.min.css http://127.0.0.1:8000/assets/css/bootstrap-extended.css http://127.0.0.1:8000/assets/css/bootstrap-select.min.css http://127.0.0.1:8000/assets/plugins/datatable/css/dataTables.bootstrap5.min.css http://127.0.0.1:8000/assets/css/app.css http://127.0.0.1:8000/assets/css/custom.css http://127.0.0.1:8000/assets/css/icons.css https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css http://127.0.0.1:8000/assets/css/dark-theme.css http://127.0.0.1:8000/assets/css/semi-dark.css http://127.0.0.1:8000/assets/css/header-colors.css http://127.0.0.1:8000/assets/css/range.css http://127.0.0.1:8000/assets/css/jquery.dataTables.min.css http://127.0.0.1:8000/assets/css/buttons.dataTables.min.css http://127.0.0.1:8000/assets/css/responsive.dataTables.min.css https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css https://cdn.datatables.net;",
            "font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com http://127.0.0.1:8000 https://cdn.lineicons.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net;",
            "img-src 'self' data: http://edharti.eu-north-1.elasticbeanstalk.com http://127.0.0.1:8000 https://mt1.google.com https://*.google.com https://*.googleusercontent.com https://ldo.gov.in https://maps.googleapis.com https://maps.gstatic.com;",
            "connect-src 'self' http://127.0.0.1:8000 https://maps.googleapis.com https://cdn.jsdelivr.net;",
            "frame-ancestors 'none';",
            "worker-src 'self' blob:",
        ]);

        $response->headers->set('Content-Security-Policy', $csp);

        return $response;
    }
}
